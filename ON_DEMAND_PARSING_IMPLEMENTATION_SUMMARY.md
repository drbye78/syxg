# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è On-Demand Parsing –¥–ª—è SF2

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**:
   - –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `Sf2SoundFont` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ SF2 —Ñ–∞–π–ª–∞
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∫–ª–∞—Å—Å–æ–≤, –∞ –Ω–µ –≤ —Å–ª–æ–≤–∞—Ä—è—Ö
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö SF2 —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

2. **–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
   - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ `Sf2SoundFont` –ø–∞—Ä—Å—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∏–º—è, –±–∞–Ω–∫, –ø—Ä–æ–≥—Ä–∞–º–º–∞)
   - –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–æ–Ω—ã, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã, –º–æ–¥—É–ª—è—Ç–æ—Ä—ã) –ø–∞—Ä—Å—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–ª–∞–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞

3. **On-Demand –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞**:
   - `get_preset(program, bank)` - –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ—Å–µ—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º
   - `get_instrument(index)` - –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º
   - `get_sample_header(index)` - –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—ç–º–ø–ª–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ —Ä–∞—Å–ø–∞—Ä—à–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –ò–∑–±–µ–≥–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ üöÄ

1. **–ß–∞—Å—Ç–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞**:
   - –ú–µ—Ç–æ–¥—ã `_parse_single_preset_data` –∏ `_parse_single_instrument_data` —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É—é—Ç —á–∞—Å—Ç–∏—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
   - –ü–∞—Ä—Å–∏–Ω–≥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞/–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –¥–∞–Ω–Ω—ã—Ö

2. **–í—ã–±–æ—Ä–æ—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö**:
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã `_parse_pdta_presets_selective` –∏ `_parse_pdta_instruments_selective`
   - –ü–∞—Ä—Å—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —á–∞–Ω–∫–∏ (pbag, pgen, pmod –¥–ª—è –ø—Ä–µ—Å–µ—Ç–æ–≤; ibag, igen, imod –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–æ–Ω—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É

### –ß—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚ö†Ô∏è

1. **–¢–æ—á–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º**:
   - –ú–µ—Ç–æ–¥—ã `_parse_pbag_selective`, `_parse_ibag_selective` –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∑–æ–Ω—ã
   - –û–¥–Ω–∞–∫–æ –ø–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –µ—â–µ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ‚ùå

1. **–ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞**:
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ—á–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º –∏ –º–æ–¥—É–ª—è—Ç–æ—Ä–∞–º
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ SF2 —Ñ–∞–π–ª–∞–º–∏
   - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞

## –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –î–∞–ª—å–Ω–µ–π—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º—ã —É–∂–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥–≤–∏–Ω—É–ª–∏—Å—å –≤–ø–µ—Ä–µ–¥, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–π—Ç–∏ –¥–∞–ª—å—à–µ:

1. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–º–µ—â–µ–Ω–∏–π**:
   - –•—Ä–∞–Ω–∏—Ç—å —Ç–æ—á–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ñ–∞–π–ª–µ
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–∞–∏–±–æ–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LRU-–∫—ç—à –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ–Ω–µ
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

## –¢–µ–∫—É—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç—å
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö SF2 —Ñ–∞–π–ª–æ–≤ —Å —Ç—ã—Å—è—á–∞–º–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤

### 3. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API
- –í–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 4. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
- –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å

## –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤ `_parse_*_selective` –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ –∏ –º–æ–¥—É–ª—è—Ç–æ—Ä–∞–º–∏
3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Å–º–µ—â–µ–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –≠—Ç–∞–ø 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ SF2 —Ñ–∞–π–ª–∞–º–∏
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
1. –î–æ–±–∞–≤–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π:
- –ë—ã—Å—Ç—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –°–æ–≤–º–µ—Å—Ç–∏–º—ã–π API
- –ß–∞—Å—Ç–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è on-demand –ø–∞—Ä—Å–∏–Ω–≥–∞

–î–∞–ª—å–Ω–µ–π—à–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –¥–æ—Å—Ç–∏—á—å –∏—Å—Ç–∏–Ω–Ω–æ–π on-demand –∑–∞–≥—Ä—É–∑–∫–∏, –∫–æ–≥–¥–∞ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–∞—Ä—Å–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö.